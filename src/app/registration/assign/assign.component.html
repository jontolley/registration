<camp-loading [busy]="busy"></camp-loading>

<div class="container fixed-height" *ngIf="!busy">
  <div class="row">
    <div class="col-12 pt-4" *ngIf="errorMessage">
      <div class="alert alert-success" role="alert">
        <h4 class="alert-heading">Error</h4>
        <hr>
        <p class="mb-0">{{errorMessage | json}}</p>
      </div>
    </div>

    <h1 class="col-12">Ward Assignment</h1>
    <h3 class="col-12">Select and enter the pin for the ward you will be registering.</h3>
    <div class="col-12">
      <button (click)="authService.logout()" class="btn btn-outline-primary my-3">Logout</button>
      <a class="btn btn-secondary" [routerLink]="['/register']">Register</a>
    </div>
    <div class="col-xs-12 col-md-3 select-list">
      <h2>Stakes</h2>
      <div *ngIf="loadingGroups">
        Loading...
      </div>
      <div *ngIf="!loadingGroups">
        <ul *ngIf="groups?.length>0">
          <li *ngFor="let group of groups" [class.selected]="selectedGroup?.id === group.id" [class.assigned]="isGroupAssigned(group)" class="selectable-list-item" (click)="groupSelected(group)">{{group.name}}</li>
        </ul>
        <div *ngIf="groups?.length===0">
          No Stakes Found
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-md-6 select-list">
      <h2>Wards</h2>
      <div *ngIf="loadingSubgroups">
        Loading...
      </div>
      <div *ngIf="!loadingSubgroups">
        <ul *ngIf="subgroups?.length>0">
          <li *ngFor="let subgroup of subgroups" [class.selected]="selectedSubgroup?.id === subgroup.id" [class.assigned]="isSubgroupAssigned(subgroup)" class="selectable-list-item" (click)="subgroupSelected(subgroup)">
            <div class="row justify-content-between form-inline">
              <div class="col-md-auto">
                {{subgroup.name}}
              </div>
              <button *ngIf="isSubgroupAssigned(subgroup)" class="btn btn-outline-secondary btn-sm" type="button" (click)="removeSubgroup(subgroup.id)">Remove</button>
              <div *ngIf="!isSubgroupAssigned(subgroup) && (selectedSubgroup?.id === subgroup.id)" class="col-md-auto input-group">
                <input type="text" class="form-control" placeholder="Pin" #pinInput>
                <span class="input-group-btn">
                  <button class="btn btn-secondary btn-sm" type="button" (click)="addSubgroup(subgroup, pinInput.value)">Add</button>
                </span>
              </div>
            </div>
          </li>
        </ul>      
        <div *ngIf="subgroups?.length===0">
          No Wards Found
        </div>
      </div>
    </div>
  </div>
</div>
